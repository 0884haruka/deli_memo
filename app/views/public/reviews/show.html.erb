<div class="container">
  <div class="row">
    <div class="col-md-12">
      <p id="notice"></p>
      <h2 class="mt-3">review details</h2>
    </div>
    <div class="col-md-3">
      <%= image_tag @review.review_image.variant(resize:'300x300') if @review.review_image.attached? %>
    </div>
    <div class="col-md-9"></div>
      <table class="table t-bordered mt-5">
      <!--<table class="table table-hover">どちらにしようか考え中-->
        <tr>
          <th>投稿者</th>
          <th>商品名</th>
          <th>レビュー内容</th>
          <th>お値段（税込）</th>
          <th>地域</th>
          <th>食品カテゴリー</th>
          <th>掲載の有</th>
          <th></th>
          <th></th>
        </tr>
        <tr>
          <td>
            <!--投稿者のページへ遷移させたい-->
            <%=link_to mypage_path(@review.member.id), class: "text-decoration-none text-dark"  do %>
              <%= image_tag @review.member.get_profile_image(100,100) %><br />
               <i class="far fa-user text-danger"></i><%= @review.member.nick_name %><br />
              <% if current_member.following?(@member) %>
                <%= link_to "フォロー外す", relationships_path(member_id: @member.id), method: :delete, class: "text-decoration-none text-dark" %>
              <% else %>
                <%= link_to "フォローする", relationships_path(member_id: @member.id), method: :post, class: "text-decoration-none text-dark" %>
              <% end %>
            <% end %>
          </td>
          <td><%= @review.title %></td>
          <td><%= @review.body %></td>
          <td><%= @review.price%>円</td>
          <td><%= @review.prefecture %></td>
          <td><%= @review.food_category%></td>
          <td>
            <% if @review.is_active == true %>
              掲載
            <% end %>
            <% if @review.is_active == false %>
              未掲載
            <% end %>
          </td>
          <td>
            <% if @review.liked_by?(current_member) %>
            <p>
              <%= link_to review_likes_path(@review), method: :delete, class: "text-decoration-none text-dark" do %>
                <i class="text-danger ">♥</i><%= @review.likes.count %> いいね
              <% end %>
            </p>
            <% else %>
            <p>
              <%= link_to review_likes_path(@review), method: :post, class: "text-decoration-none text-dark" do %>
                <i class="text-danger">♡</i><%= @review.likes.count %> いいね
              <% end %>
            </p>
          <% end %>
          </td>
            <% if @review.bookmarked_by?(current_member) %>
            <td><%= link_to "ブックマークを外す", review_bookmarks_path(@review), method: :delete %></td>
              <% else %>
            <td><%= link_to "ブックマーク", review_bookmarks_path(@review), method: :post %></td>
            <% end %>
          </div>

        </tr>
        <tr>
          <td><p><i class="far fa-comment-alt text-danger"></i>コメント件数：<%= @review.comments.count %></p></td>
          <td colspan="5">
            <div>
              <div class="alert text-danger">
                <%= flash[:alert] %>
              </div>
              <% @review.comments.each do |comment| %>
              <div class="col">
                <p><%= image_tag comment.member.get_profile_image(100,100) %></p>
              </div>
              <div class="col d-flex align-text-center">
                <div>
                <%= comment.member.nick_name %><br />
                <%= comment.created_at.strftime('%Y/%m/%d') %><br />
                <%= comment.comment %><br />
                <% if comment.member == current_member %><br />
                  <%= link_to "削除", review_comment_path(comment.review, comment), method: :delete %>
                <% end %>
                </div>
              </div>
              <% end %>
            </div>
            <div class="comment">
              <%= form_with model: [@review, @comment] do |f| %>
                <%= f.text_area :comment, rows: '5', placeholder: "コメントをここに" %>
                <%= f.submit "送信する" %>
              <% end %>
            </div>
          </td>
        </tr>
      </table>
    </div>
    
    <% if @member == current_member %>
    <div class = "text-center">
      <%= link_to "編集する", edit_review_path, class: "btn btn-outline-danger col-6" %>
    </div>
    <div class = "text-center mt-3">
      <%= link_to "削除する", review_path(@review), method: :delete, data: {confirm: "本当に削除しますか？"}, class: "btn btn-outline-secondary col-6" %>
    </div>
    <% end %>
  </div>
</div>
